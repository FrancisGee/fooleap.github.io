<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Vim 与系统剪切板交互 | Fooleap's Blog</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="A foolish man could not always lose!">
    <meta name="keywords" content="Vim, 剪切板, ArchLinux" />
    <link rel="canonical" href="http://blog.fooleap.org/using-vim-with-clipboard-on-archlinux.html">
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="/js/modernizr.js"></script>
    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/js.js"></script>
  </head>
  <body>
  <div class="wrapper">
    <header class="site-header">
      <h1>
        Vim 与系统剪切板交互
      </h1>
    </header>

    <nav class="navigation hide">
        <ul class="navigation-list">
            <li><a href="/" class="navigation-item">Fooleap's Blog</a></li>
            <li><a href="/about.html" class="navigation-item">About</a></li>
            <li><a href="/guestbook.html" class="navigation-item">Guestbook</a></li>
            <li><a href="http://feed.fooleap.org/" target="_blank" class="navigation-item">RSS</a></li>
            <li><a href="#" id="top" class="navigation-item icon-arrow-up">Top</a></li>
	    <li><a href="/links.html"  class="navigation-item icon-home">Blogroll</a></li>
        </ul>
        <img src="/img/avatar.jpg" width="40" height="40" class="avatar" title="Navigation"/>
    </nav>

    <section class="page-content">
      <div class="post">

  <time>
    Jan 24, 2013
  </time>
  
  <article class="post-content">
  <p>很多时候使用 Vim 编辑文本，总需要复制里面的东西出来，粘贴到其他地方，比如说网页，聊天窗口等等，而有些时候有需要从网页等地方复制文字过来粘贴到 Vim 正在编辑的文件里。这个两个过程应该怎么完成呢？</p>

<h3 id="section">一般的解决方法</h3>

<p><strong>复制文本</strong></p>

<p>当我们要将 Vim 里面的文本复制出来，往往会用鼠标选中，然后到需要粘贴的地方小点下鼠标中键或 Shift-Insert，完成复制粘贴的过程。</p>

<p>但 Vim 设置显示行号，多窗口使用，或者使用 Tmux 这类有利于提高效率的工具的时候，这样选择未必行的通。</p>

<p>这时候，需要鼠标可以选中 Vim 单个窗口且不包含行号的文本，可以使用 :set mouse=a，让 Vim 支持鼠标选择，大概事情就可以解决，这样的感觉也挺爽的，赶紧把 set mouse=a 加入你的 .vimrc 文件:)</p>

<p><strong>粘贴文本</strong></p>

<p>当我们在其他地方选择文本后，想粘贴到 Vim，一般都会切换到插入模式点鼠标中键或 Shift-Insert，完成复制粘贴的过程。</p>

<p>但有些时候，比如说复制在网页一些代码，粘贴时有时会出现不对齐，前面未加注释代码却被加上注释，这样一些恼人的问题。</p>

<p>这时候，可以通过 :set paste 将 Vim 设置为粘贴模式后再进行粘贴，既然是两种模式，肯定是有区别的，:set nopaste 是返回正常模式。这么干毕竟不方便，可以通过 .vimrc 添加映射来解决这个问题，更是有 set pastetoggle= 这个方便的选项，若在 .vimrc 文件里添加 set pastetoggle=&lt;F11&gt;，则 F11 为粘贴模式的切换键。</p>

<h3 id="vim-">比较 Vim 的方法</h3>

<p>上述方法，大致可以解决问题，但很多同学并不喜欢用这种方式来复制粘贴，或是喜欢键盘操作的爽快，或是习惯了 Windows 下那套 Ctrl-C, Ctrl-V，通过系统剪切板来实现。还有，使用 VirtualBox 的时候，若设置剪切板互通，也是用到系统剪切板。</p>

<p>Vim 不是通过 Ctrl-C, Ctrl-X, Ctrl-V 来实现复制、剪切、粘贴的，而是通过 y, d, p 这些更为方便的键来实现各种复杂的文本操作。</p>

<p>对于和系统剪贴板的交互，又应该怎么用呢？遇到问题一般第一个寻找的是帮助文档，剪切板即是 Clipboard。</p>

<p>通过 :h clipboard 查看帮助，发现里面有一句这样的话</p>

<blockquote>
  <p>When using this register under X11, also see x11-selection.</p>

  <p>若在 X11 中使用该寄存器，另见 x11-selection。</p>
</blockquote>

<p>顺着思路 :h x11-selection，里面详细地介绍了 Vim 提供的使用 X11 主选择缓冲区和剪切板的方法，它们是通过 “* 和 “+ 两个寄存器来实现。</p>

<p>大致可以明白，在 Windows 上只能通过 Clipboard，而可爱的 X11 却还给了我们 Primary，所以有了选中即复制，鼠标中间即粘贴这么神奇的粘贴操作。</p>

<p>在 Vim 里，正常模式下，复制文本到 Clipboard，基本只是在前面加上 “+，其他一样，例如</p>

<p>复制当前行</p>

<pre><code>"+yy 或 "+Y
</code></pre>

<p>复制当前行及向下二行</p>

<pre><code>"+y2j
</code></pre>

<p>选择后复制</p>

<pre><code>Vjj"+y 
</code></pre>

<p>复制到 Primary 和复制到 Clipboard 差不多，这里就不再详述，而粘贴则是加 p，自然还有剪切 d。</p>

<h3 id="section-1">注意</h3>

<p>需要注意的是，Arch Linux 官方仓库中的 Vim 并不支持以上操作</p>

<pre><code>$ vim --version | grep clipboard
</code></pre>

<p>返回显示 clipboard 及 xterm_clipboard 前面是减，我们可以安装 gvim 来使 Vim 支持 X</p>

<pre><code># pacman -S gvim
</code></pre>

<p>也可通过 ABS 这种方便的编译系统，重新编译 Vim</p>

<pre><code># pacman -S abs
# abs extra/vim
# cp -r /var/abs/extra/vim ~/ &amp;&amp; cd ~/vim
</code></pre>

<p>修改 PKGBUILD 文件</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>PKGBUILD</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>...
pkgname=('vim'<del> 'gvim' 'vim-runtime'</del>)
# 去除不需要编译的包
# 至于编译依赖，不了解可以像我一样选择不取消
...
--with-x=<del>no</del>yes \
# 把 Vim 编译选项中 --with-x 的 no 改为 yes
...
</code></pre>

<p>编译并创建包</p>

<pre><code>$ makepkg -s
</code></pre>

<p>安装 Vim</p>

<pre><code># pacman -U vim-7.3.754-1-x86_64.pkg.tar.xz
</code></pre>

<p>重新进行验证，果然生效</p>

<p><strong>参考资料</strong></p>

<ul>
  <li><a href="http://maxolasersquad.blogspot.com/2012/01/copy-and-paste-from-system-clipboard.html">Copy and paste from the system clipboard with vim</a></li>
  <li><a href="http://www.jwz.org/doc/x-cut-and-paste.html">X Selections, Cut Buffers, and Kill Rings.</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/Arch_Build_System">Arch Build System</a></li>
</ul>

<p><strong>本文历史</strong></p>

<ul>
  <li>2013年01月24日 完成初稿</li>
</ul>

  </article>

  <script type="text/javascript" id="wumiiRelatedItems"></script>
  <script type="text/javascript">
    var wumiiPermaLink = ""; //请用代码生成文章永久的链接
    var wumiiTitle = ""; //请用代码生成文章标题
    var wumiiTags = ""; //请用代码生成文章标签，以英文逗号分隔，如："标签1,标签2"
    var wumiiSitePrefix = "http://blog.fooleap.org/";
    var wumiiParams = "&num=5&mode=1&pf=JAVASCRIPT";
  </script>
  <script type="text/javascript" src="http://widget.wumii.com/ext/relatedItemsWidget"></script>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
     /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
     var disqus_shortname = 'fooleap'; // required: replace example with your forum shortname

     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
    
</div>

    </section>

    <footer class="site-footer">
      <p>2011-2014 Proudly powered by Jekyll</p>
    </footer>
  </div>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16717905-7']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    //Baidu
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffa7ec982118ebd236663169678264582' type='text/javascript'%3E%3C/script%3E"));
  </script>

  </body>
</html>
