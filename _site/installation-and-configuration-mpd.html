<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>安装和配置 MPD | Fooleap's Blog</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="A foolish man could not always lose!">
    <meta name="keywords" content="MPD, MPC, 播放器" />
    <link rel="canonical" href="http://blog.fooleap.org/installation-and-configuration-mpd.html">
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="/js/modernizr.js"></script>
    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/js.js"></script>
  </head>
  <body>
  <div class="wrapper">
    <header class="site-header">
      <h1>
        安装和配置 MPD
      </h1>
    </header>

    <nav class="navigation hide">
        <ul class="navigation-list">
            <li><a href="/" class="navigation-item">Fooleap's Blog</a></li>
            <li><a href="/about.html" class="navigation-item">About</a></li>
            <li><a href="/guestbook.html" class="navigation-item">Guestbook</a></li>
            <li><a href="http://feed.fooleap.org/" target="_blank" class="navigation-item">RSS</a></li>
            <li><a href="#" id="top" class="navigation-item icon-arrow-up">Top</a></li>
	    <li><a href="/links.html"  class="navigation-item icon-home">Blogroll</a></li>
        </ul>
        <img src="/img/avatar.jpg" width="40" height="40" class="avatar" title="Navigation"/>
    </nav>

    <section class="page-content">
      <div class="post">

  <time>
    Dec 1, 2012
  </time>
  
  <article class="post-content">
  <p>使用 i3 窗口管理器，感觉很舒服，更有帅帅的 i3status 点缀之，在 GitHub 搜了下，发现有个 <a href="https://github.com/Gravemind/i3status">i3status 修改版</a>，可以显示 MPD 的播放状态，于是又用起 MPD。</p>

<p>MPD (<a href="https://wiki.archlinux.org/index.php/Music_Player_Daemon">Music Player Daemon</a>) 是一个实用的音乐播放器，以其独特的 C/S 结构获得人们的喜爱。充其量 MPD 只是作为一个守护进程（或者可以说服务）运行于后台，想要控制它的播放，还需要一个客户端，一般只选用 MPC (Music Player Command)， MPC 虽为命令行客户端，但已够用。</p>

<p>下面一起来安装配置 MPD，获得恰到好处的使用体验</p>

<p><strong>MPD</strong></p>

<p>安装 MPD, MPC</p>

<pre><code># pacman -S mpd mpc
</code></pre>

<p>创建 MPD 的配置文件</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.mpdconf</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>music_directory         "~/Music/"
playlist_directory      "~/.mpd/playlists"
db_file                 "~/.mpd/database"
log_file                "~/.mpd/log"
pid_file                "~/.mpd/pid"
state_file              "~/.mpd/state"
user                    "fooleap"
group                   "users"
bind_to_address         "localhost"
port                    "6600"
audio_output {
	type            "alsa"
	name            "My ALSA Device"
	mixer_control   "Master"
}</code></pre>

<p>更多配置可参考 /usr/share/mpd/mpd.conf.example</p>

<pre><code>$ mkdir -p ~/.mpd/playlists
$ touch ~/.mpd/{database,log,pid,state}
</code></pre>

<p>至此，可直接运行 mpd 命令以启动</p>

<p>通过 systemd 设置自启，默认配置不是普通用户的，遂先修改 mpd.service 文件，指定配置</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>/usr/lib/systemd/system/mpd.service</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>...
[Service]
ExecStart=/usr/bin/mpd /home/fooleap/.mpdconf --no-daemon
...</code></pre>

<pre><code># systemctl enable mpd
</code></pre>

<p><strong>均衡器</strong></p>

<p>播放器是有了，但 MPD 不带均衡器，在此使用 <a href="http://www.thedigitalmachine.net/alsaequal.html">Alsaequal</a> 充当均衡器</p>

<p>安装</p>

<pre><code>$ yaourt -S alsaequal caps
</code></pre>

<p>配置</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.asoundrc</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>ctl.equal {
 type equal;
}

pcm.plugequal {
  type equal;
  # Modify the line below if you do not
  # want to use sound card 0.
  #slave.pcm "plughw:0,0";
  #by default we want to play from more sources at time:
  slave.pcm "plug:dmix";
}
#pcm.equal {
  # If you don't want the equalizer to be your
  # default soundcard comment the following
  # line and uncomment the above line. (You can
  # choose it as the output device by addressing
  # it with specific apps,eg mpg123 -a equal 06.Back_In_Black.mp3)
pcm.!default {
  type plug;
  slave.pcm plugequal;
}</code></pre>

<p>重启 Alsa 后，可调整增益值</p>

<pre><code>$ alsamixer -D equal
</code></pre>

<p><img src="http://pic.yupoo.com/fooleap_v/CuwYddO3/p82aA.png" alt="Alsaequal" /></p>

<p>配置 MPD</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.mpdconf</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>...
audio_output {
  type    "alsa"
  name    "My ALSA Device"
  device  "plug:plugequal"
  mixer_control	"Master"		# optional
}
...</code></pre>

<p><strong>MPC</strong></p>

<p>尝试播放</p>

<pre><code>$ mpc listall | mpc add
$ mpc play
</code></pre>

<ul>
<li>添加所有音乐到当前播放列表</li>
<li>播放</li>
</ul>

<p>播放列表</p>

<p>通过 MPC 创建的是 *.m3u 格式的 Playlist</p>

<p>假设 ~/Music 文件夹里有多个文件夹，创建播放列表，包含某目录（或多目录）下所有音乐</p>

<pre><code>$ mpc clear
$ mpc ls
$ mpc listall FolderName1 FolderName2 .. | mpc add
$ mpc save playlist
$ mpc load playlist
</code></pre>

<ul>
<li>清空当前播放列表</li>
<li>列出文件夹</li>
<li>显示名字为 FolderName1 FolderName2 文件夹下的所有音乐并添加到当前播放列表</li>
<li>保存当前播放列表为 playlist</li>
<li>读取播放列表 playlist</li>
</ul>

<p>也可以通过类似下面的命令来创建播放列表，萝卜青菜</p>

<pre><code>$ cd ~/Music
$ find * -iname "*.mp3" | sort | grep Keyword &gt; ~/.mpd/playlist/playlist.m3u
</code></pre>

<p>更多使用可以参考 man mpc</p>

<p><strong>多媒体键</strong></p>

<p>使用 Thinkpad 多媒体键来代替常用的 mpc 命令再合适不过，这里通过 <a href="https://wiki.archlinux.org/index.php/Xbindkeys">Xbindkeys</a> 来绑定</p>

<p>安装 Xbindkeys</p>

<pre><code># pacman -S xbindkeys
</code></pre>

<p>配置 Xbindkeys</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.xbindkeysrc</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>"mpc toggle"
XF86AudioPlay

"mpc stop"
XF86AudioStop

"mpc prev"
XF86AudioPrev

"mpc next"
XF86AudioNext

"amixer sset Master 2-"
XF86AudioLowerVolume

"amixer sset Master 2+"
XF86AudioRaiseVolume

"amixer sset Master toggle"
XF86AudioMute</code></pre>

<p>将 xbindkeys &amp; 添加到 ~/.xinitrc 使其随 X 启动</p>

<p><strong>键映射</strong></p>

<p>在此之前，可能需要通过 <a href="https://wiki.archlinux.org/index.php/Xmodmap">Xmodmap</a> 修改键映射</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.Xmodmap</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>!Media
keycode 173 = XF86AudioPrev
keycode 172 = XF86AudioPlay
keycode 171 = XF86AudioNext
keycode 174 = XF86AudioStop

!Volume
keycode 121 = XF86AudioMute
keycode 122 = XF86AudioLowerVolume
keycode 123 = XF86AudioRaiseVolume</code></pre>

<p>将 xmodmap ~/.Xmodmap &amp; 添加到 ~/.xinitrc 使其随 X 启动</p>

<p><img src="http://pic.yupoo.com/fooleap_v/CsoTzarg/pbFZZ.png" alt="i3status with mpd" /></p>

<p><strong>本文历史</strong></p>

<ul>
  <li>2012年12月01日 创建文章</li>
  <li>2012年12月02日 修正 mpc 歌曲列表部分的错误</li>
  <li>2012年12月15日 添加配置均衡器</li>
</ul>

  </article>

  <script type="text/javascript" id="wumiiRelatedItems"></script>
  <script type="text/javascript">
    var wumiiPermaLink = ""; //请用代码生成文章永久的链接
    var wumiiTitle = ""; //请用代码生成文章标题
    var wumiiTags = ""; //请用代码生成文章标签，以英文逗号分隔，如："标签1,标签2"
    var wumiiSitePrefix = "http://blog.fooleap.org/";
    var wumiiParams = "&num=5&mode=1&pf=JAVASCRIPT";
  </script>
  <script type="text/javascript" src="http://widget.wumii.com/ext/relatedItemsWidget"></script>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
     /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
     var disqus_shortname = 'fooleap'; // required: replace example with your forum shortname

     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
    
</div>

    </section>

    <footer class="site-footer">
      <p>2011-2014 Proudly powered by Jekyll</p>
    </footer>
  </div>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16717905-7']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    //Baidu
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffa7ec982118ebd236663169678264582' type='text/javascript'%3E%3C/script%3E"));
  </script>

  </body>
</html>
