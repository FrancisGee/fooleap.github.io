<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>使用 Git 管理静态网站 | Fooleap's Blog</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="A foolish man could not always lose!">
    <meta name="keywords" content="Git, SSH, VPS" />
    <link rel="canonical" href="http://blog.fooleap.org/using-git-to-manage-a-website.html">
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="/js/modernizr.js"></script>
    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/js.js"></script>
  </head>
  <body>
  <div class="wrapper">
    <header class="site-header">
      <h1>
        使用 Git 管理静态网站
      </h1>
    </header>

    <nav class="navigation hide">
        <ul class="navigation-list">
            <li><a href="/" class="navigation-item">Fooleap's Blog</a></li>
            <li><a href="/about.html" class="navigation-item">About</a></li>
            <li><a href="/guestbook.html" class="navigation-item">Guestbook</a></li>
            <li><a href="http://feed.fooleap.org/" target="_blank" class="navigation-item">RSS</a></li>
            <li><a href="#" id="top" class="navigation-item icon-arrow-up">Top</a></li>
	    <li><a href="/links.html"  class="navigation-item icon-home">Blogroll</a></li>
        </ul>
        <img src="/img/avatar.jpg" width="40" height="40" class="avatar" title="Navigation"/>
    </nav>

    <section class="page-content">
      <div class="post">

  <time>
    Jan 10, 2013
  </time>
  
  <article class="post-content">
  <p>本博使用 GitHub Pages，很喜欢使用 Git 这种方式管理网站，下面就一起来看看如何使用 Git 来管理静态网站</p>

<p>以下参考这篇文章 <a href="http://toroid.org/ams/git-website-howto">Using Git to manage a web site</a></p>

<p>假设有一台 VPS，它的域名是 fooleap.org，我们可以通过 SSH 登录进行操作</p>

<p>先在服务器上创建一个新账户 git</p>

<pre><code>$ ssh root@fooleap.org 'adduser git'
</code></pre>

<h3 id="ssh-">SSH 自动登录</h3>

<p>使用公钥互信实现自动登录</p>

<pre><code>$ ssh git@fooleap.org 'mkdir .ssh'
$ ssh git@fooleap.org 'cat &gt;&gt; ~/.ssh/authorized_keys' &lt; ~/.ssh/id_rsa.pub
</code></pre>

<ul>
  <li>在服务器的 ~/.ssh/authorized_keys 文件添加本地公钥</li>
</ul>

<p>可以在本地的 ~/.ssh/config 文件定义 host git 对应的主机名及用户名</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>~/.ssh/config</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>host git
hostname fooleap.org
user git</code></pre>

<p>经过这样处理之后，我们就可以通过 ssh git 自动登录服务器</p>

<h3 id="section">服务器端</h3>

<pre><code>$ mkdir web.git &amp;&amp; cd web.git
$ git --bare init
</code></pre>

<ul>
  <li>初始化，添加 bare 参数是为了创建一个裸仓库，即不包含工作目录</li>
</ul>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>./hooks/post-receive</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>#!/bin/sh
GIT_WORK_TREE=~/web git checkout -f</code></pre>

<pre><code>$ chmod +x hooks/post-receive
</code></pre>

<ul>
  <li>在挂钩目录 hooks 下创建一个 post-receive 文件，并赋予它可执行权限</li>
</ul>

<p><strong>这么做的作用是什么呢？</strong></p>

<p>当我们在本地执行推送后，会自动执行这个脚本，将 ~/web 这个目录作为工作目录并进行 checkout 操作</p>

<pre><code>$ cd &amp;&amp; mkdir web </code></pre>

<ul>
  <li>创建工作目录，这个目录可通过 Nginx 等设置对其访问</li>
</ul>

<p>为用户 git 指定一个专用的 shell</p>

<pre style="margin-bottom: 0; border-bottom:none; padding-bottom:8px;"><code>/etc/passwd</code></pre>
<pre style="margin-top: 0; border-top-style:dashed; padding-top:8px;"><code>- git:x:1001:1000:,,,:/home/git:/bin/bash
+ git:x:1001:1000:,,,:/home/git:/usr/bin/git-shell</code></pre>

<ul>
  <li>将默认的 shell: bash 替换为 git-shell</li>
</ul>

<p>这是为多人管理网站做的准备，作为协作管理的权限</p>

<h3 id="section-1">客户端</h3>

<pre><code>$ mkdir web &amp;&amp; cd web
$ git init
$ echo "Hello World" &gt; index.html
$ git add . 
$ git commit -m "add index.html"
$ git remote add web git@fooleap.org:web.git
$ git push web +master:refs/heads/master
</code></pre>

<ul><li>初始化本地仓库，提交一个版本，添加远程仓库并推送</li></ul>

<p>以后我们就可以在使用 git 来维护静态网站，要更新服务器端的时候，只需轻轻一推</p>

<pre><code>$ git push web
</code></pre>

<p>鄙人外语能力不足，没法和原文一样详细描述，Git 的使用也是半桶屎，有哪里说错，还请指出</p>

<p><strong>参考资料</strong></p>

<ul>
  <li>typeof.net: <a href="http://typeof.net/mechanix/static-website-using-git-in-actions.html">实战：用 git 搭建静态网站</a></li>
  <li>Pro Git: <a href="http://git-scm.com/book/zh/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-%E6%9E%B6%E8%AE%BE%E6%9C%8D%E5%8A%A1%E5%99%A8">4.4 服务器上的 Git - 架设服务器</a> <a href="http://git-scm.com/book/zh/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git%E6%8C%82%E9%92%A9#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%8C%82%E9%92%A9">7.3 自定义 Git - Git挂钩</a> </li>
  <li>man githooks: <a href="http://www.kernel.org/pub/software/scm/git/docs/githooks.html#post-receive">githooks(5)</a></li>
</ul>

<p><strong>本文历史</strong></p>

<ul>
  <li>2013年01月10日 完成初稿</li>
</ul>

  </article>

  <script type="text/javascript" id="wumiiRelatedItems"></script>
  <script type="text/javascript">
    var wumiiPermaLink = ""; //请用代码生成文章永久的链接
    var wumiiTitle = ""; //请用代码生成文章标题
    var wumiiTags = ""; //请用代码生成文章标签，以英文逗号分隔，如："标签1,标签2"
    var wumiiSitePrefix = "http://blog.fooleap.org/";
    var wumiiParams = "&num=5&mode=1&pf=JAVASCRIPT";
  </script>
  <script type="text/javascript" src="http://widget.wumii.com/ext/relatedItemsWidget"></script>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
     /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
     var disqus_shortname = 'fooleap'; // required: replace example with your forum shortname

     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
    
</div>

    </section>

    <footer class="site-footer">
      <p>2011-2014 Proudly powered by Jekyll</p>
    </footer>
  </div>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16717905-7']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    //Baidu
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffa7ec982118ebd236663169678264582' type='text/javascript'%3E%3C/script%3E"));
  </script>

  </body>
</html>
